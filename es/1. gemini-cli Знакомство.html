## Gemini CLI: Introducción y primeros pasos.

**Gemini CLI** es una herramienta que funciona directamente en su terminal, comprende su base de código y ayuda a corregir errores mediante consultas en lenguaje natural. Esta es la respuesta de Google a Claude Code de Anthropic.
Puede usar Gemini 2.5 Pro (si se alcanza el límite, la herramienta cambiará a Gemini 2.5 Flash) y su ventana de contexto de 1 millón de tokens para realizar hasta 60 solicitudes por minuto y 1000 solicitudes por día, todo de forma gratuita.

### Contenido
*   Comprender y navegar por grandes bases de código
*   Detección y corrección de errores
*   Escritura y prueba de código
*   Herramientas de Gemini CLI
*   Integración de Google CLI con MCP

### Características clave de Gemini CLI:
*   **Edición y refactorización:** Mejora y simplifica automáticamente su código bajo la guía de la IA.
*   **Detección y corrección de errores:** Encuentra errores y sugiere soluciones.
*   **Comprensión del código:** Gemini CLI puede resumir la arquitectura, explicar los roles de los módulos o construir mapas de flujo de ejecución.
*   **Generación de pruebas:** Crea automáticamente tareas de prueba para `pytest`
*   **Soporte de documentación:** Puede crear documentos Markdown estructurados, registros de cambios (changelogs) y responder a problemas de GitHub directamente en la terminal.
*   **Ejecución de comandos:** Gemini CLI puede ejecutar comandos de shell como `git`, `npm`, `pip` y otros, lo que le permite administrar proyectos sin salir de la CLI.

---


### Paso 1: Requisitos previos

Primero, instale Node.js (versión 18 o superior). Puede descargar el instalador de su elección o ejecutar los siguientes comandos bash en su terminal:

```bash
# Descargar e instalar nvm (Node Version Manager):
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

# Inicializar nvm en la sesión de terminal actual
. "$HOME/.nvm/nvm.sh"

# Descargar e instalar Node.js (por ejemplo, versión 22):
nvm install 22

# Verificar la versión de Node.js:
node -v # Debería mostrar "v22.17.0" o similar

# Verificar la versión de npm:
npm -v # Debería mostrar "10.9.2" o similar
```

> ⚠️ **Importante para usuarios de Windows:**
> El comando `nvm` anterior es para **Linux/macOS** y **no funcionará en PowerShell o cmd.exe**.
> Para Windows, use [nvm-windows](https://github.com/coreybutler/nvm-windows), descargando `nvm-setup.exe` de la sección [Releases](https://github.com/coreybutler/nvm-windows/releases).
> Alternativamente, puede instalar WSL (Subsistema de Windows para Linux) y ejecutar comandos en Ubuntu o otra distribución de Linux.

---
### Paso 2: Configuración de Gemini CLI

#### Paso 2.1: Instalación de Gemini CLI
Una vez que Node.js y npm estén instalados y verificados, instale Gemini CLI ejecutando el siguiente comando en su terminal:
```bash
npx https://github.com/google-gemini/gemini-cli
```
O use `npm` para una instalación global:
```bash
npm install -g @google/gemini-cli
gemini
```
Después de la instalación, escriba `gemini` en la terminal para acceder a la herramienta.



#### Paso 2.2: Autenticación
Puede usar su cuenta personal de Google para la autenticación. Esto le dará hasta 60 solicitudes por minuto y 1000 solicitudes por día cuando use Gemini.
![First Run](assets/gemini_cli_1/auth.png)

En esta guía, utilicé **Iniciar sesión con Google**, pero también puede usar una **clave API** (establecida como variable de entorno o en un archivo `.env`) o autenticación a través de **Vertex AI**.

Para generar una nueva clave API, inicie sesión en **AI Studio** con su cuenta de Google y haga clic en "Crear clave API".
```bash
# Establecer clave como variable de entorno
export GEMINI_API_KEY="Your_API_Key"

# O crear un archivo .env
GEMINI_API_KEY="Your_API_Key"
```
Puede usar el comando `/auth` en el campo de texto para cambiar los métodos de autenticación según sea necesario.

---

### Paso 3: Configuración de un proyecto en Gemini CLI
![Start](assets/gemini_cli_1/start.png)
Una vez que la CLI esté en funcionamiento, podemos comenzar a interactuar con Gemini desde la terminal. Hay dos formas de trabajar con un proyecto.

#### 1. Iniciar un nuevo proyecto
Para iniciar un proyecto desde cero, ejecute los siguientes comandos:
```bash
cd new-project/
gemini
```
Dentro de la CLI, use un mensaje para resolver el problema que le interese, por ejemplo:
> Escriba un código de codificador para un transformador desde cero.
![Example 1](assets/gemini_cli_1/example_1.png)
Conceda permiso para escribir archivos:
![File](assets/gemini_cli/file.png)

#### 2. Trabajar con un proyecto existente
Si ya tiene una base de código, puede trabajar con ella ejecutando los siguientes comandos:
```bash
git clone https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo
cd Google-Agent-Development-Kit-Demo
gemini
```
Dentro de la CLI, use un mensaje, por ejemplo:
> Proporcione un resumen de todos los cambios realizados en la base de código en el último mes.

---

### Paso 4: Experimentando con Gemini CLI
Como ejemplo, usaré el proyecto **[Planificador de viajes basado en ADK 🌍🛫](https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo)**.
Con Gemini CLI, mostraré cómo:
1.  explorar la base de código
2.  detectar un error o problema en GitHub o en un archivo
3.  refactorizar código y generar pruebas unitarias
4.  crear un informe Markdown de los cambios realizados
5.  visualizar la base de código generando un diagrama de flujo

#### Explorando y comprendiendo la base de código
Comencemos pidiéndole a Gemini que explore y explique la base de código.

**Mensaje:** `Explore el directorio actual y describa la arquitectura del proyecto.`

Gemini CLI devolverá un resumen estructurado que explica la arquitectura:
*   **Interfaz de usuario:** La aplicación Streamlit (`travel_ui.py`) proporciona una interfaz para la interacción.
*   **Orquestación:** `host_agent` actúa como un coordinador central.
*   **Agentes especializados:** `flight_agent`, `stay_agent`, `activities_agent` para encontrar vuelos, hoteles y entretenimiento.
*   **Comunicación:** Los agentes se comunican entre sí a través de una API RESTful en FastAPI.
*   **Componentes compartidos:** `shared/schemas.py` define estructuras de datos comunes.

Esto le ayudará a navegar sin leer cada archivo manualmente.

#### Analizando y corrigiendo un problema de GitHub
Exploremos algunos problemas abiertos del repositorio de GitHub.

**Mensaje:** `Aquí hay un problema de GitHub: [@search https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo/issues/1]. Analice la base de código y proponga un plan de solución de 3 pasos. ¿Qué archivos/funciones deben cambiarse?`

Gemini CLI exploró el problema:
*   Usando la función `@search`, recuperó datos de GitHub.
*   Identificó la causa raíz como un error de serialización JSON (en este caso, la función asíncrona `create_session()` no se llamó con `await`).
*   Sugirió cambios y manejo de respuestas en varios archivos.

A continuación, la CLI espera la entrada del usuario para evaluar los cambios. Si el usuario está de acuerdo, aplicará los cambios sugeridos.

#### Implementando y probando la solución
Ahora implementemos y probemos las soluciones sugeridas por Gemini.

**Mensaje:** `Escriba una prueba unitaria para este cambio en pytest en el archivo test_shared.py.`

Gemini CLI:
*   Insertó `json.dumps()` antes de enviar la carga útil de la tarea.
*   Creó `test_agents.py` para agregar pruebas unitarias.
*   Agregó un nuevo caso de prueba para verificar el esquema y pasar mensajes de agente anidados.

#### Generando documentación
Ahora que se han realizado las correcciones, resumamos los cambios y escribámoslos en Markdown en un archivo `.txt`.

**Mensaje:** `Escriba un resumen de Markdown del error, la solución y la cobertura de la prueba. Formatee como una entrada de registro de cambios en la versión "v0.2.0".`

Luego, para guardar el resumen en un documento, utilicé el siguiente mensaje:

**Mensaje:** `Guarde este resumen en un archivo .txt y nómbrelo summary.txt`

Gemini CLI utiliza la herramienta `WriteFile` para guardar el archivo `summary.txt` en el directorio del proyecto.

#### Generando un diagrama de flujo usando MCP
Esta sección amplía experimentos anteriores donde exploro cómo Gemini CLI usa el **Protocolo de Contexto del Modelo (MCP)** para mantener resúmenes a nivel de archivo e historial de tareas entre mensajes. Esto le da a Gemini "memoria de trabajo" dentro de una sesión.

**Mensaje:** `Genere un diagrama de flujo que muestre cómo los agentes se comunican a través de A2A (agente a agente) y cómo main.py administra el sistema. Resalte dónde ocurrió el problema y cómo se solucionó.`

Esta visualización fue posible gracias a la memoria persistente de Gemini, que retuvo el contexto completo de nuestra corrección de errores anterior y la estructura del agente sin necesidad de recargar archivos.

### Herramientas de Gemini CLI disponibles
Al llamar al comando `/tools` en Gemini CLI, se mostrará una lista de herramientas disponibles que se pueden usar para realizar varias tareas, como edición de código, generación de pruebas, creación de documentación y más.
![Tools](assets/gemini_cli_1/tools.png)

**ReadFolder (ls)**
Lista archivos y carpetas en un directorio, similar al comando `ls` en la línea de comandos.

**ReadFile (read-file)**
Lee el contenido completo de un solo archivo, útil para crear resúmenes o análisis.

**ReadManyFiles (read-many-files)**
Lee varios archivos a la vez, generalmente por patrón (por ejemplo, todos los archivos `.js`).

**FindFiles (glob)**
Busca archivos por patrón (por ejemplo, encontrar todos los archivos `config.json` en su proyecto).

**SearchText (grep)**
Busca texto dentro de los archivos, por ejemplo, para encontrar todos los comentarios `TODO`.

**Edit (edit)**
Aplica cambios de código usando `diff`. Gemini muestra una vista previa de los cambios y solicita confirmación antes de aplicarlos.

**WriteFile (write-file)**
Crea nuevos archivos (por ejemplo, `README.md`) con el contenido proporcionado por el usuario.

**Shell (shell)**
Ejecuta comandos directamente en la terminal si los precede con `!` (por ejemplo, `!npm test`).

**WebFetch (web-fetch)**
Descarga contenido de la web (HTML o JSON), lo que permite a Gemini analizar datos externos.

**GoogleSearch (web-search)**
Realiza una búsqueda en Google para basar las respuestas en información del mundo real (por ejemplo, para encontrar una explicación de un error).

**Save Memory (memoryTool)**
Guarda hechos o preferencias durante una sesión (por ejemplo, "Prefiero async/await") para mejorar la coherencia y la coherencia de las respuestas.


### Funciones avanzadas

Puede agregar instrucciones especiales para la IA para un proyecto específico,
creando un archivo `GEMINI.md` en el directorio raíz de su proyecto.
Dentro de este archivo, puede definir las reglas del proyecto,
los estilos de código y las herramientas que debe usar el agente. Esto garantiza que el código generado cumpla con los estándares de su proyecto.

[Ejemplo de instrucción del sistema](https://github.com/hypo69/hypotez/blob/master/src/endpoints/hypo69/code_assistant/instructions/CODE_RULES.EN.MD)

### Integración de Google CLI con MCP

Para la mayoría de las tareas diarias, las herramientas integradas serán suficientes. Pero, ¿qué pasa si desea que Gemini CLI haga algo muy especializado, como interactuar con API específicas o usar un modelo especializado (por ejemplo, un generador de imágenes o una herramienta de análisis de seguridad)? Aquí es donde entra en juego el MCP (Protocolo de Contexto del Modelo).

Esencialmente, MCP es un estándar abierto que permite a los desarrolladores agregar nuevas herramientas y capacidades a la IA ejecutando un servidor con el que la CLI puede interactuar. En Gemini CLI, puede configurar "servidores MCP" en un archivo de configuración JSON, y la CLI los tratará como herramientas adicionales que puede usar.

#### Cómo configurar un servidor MCP en Google CLI

Como ejemplo, le mostraré cómo configurar un servidor MCP para GitHub en Gemini CLI.

Dentro de la carpeta de su proyecto, cree una carpeta usando el comando:

```bash
mkdir -p .gemini && touch .gemini/settings.json
```
Rellene el archivo con este código:
```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": { "GITHUB_PERSONAL_ACCESS_TOKEN": "[YOUR-TOKEN]" }
    }
  }
}
```
[instrucciones sobre cómo obtener un token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic)
Después de eso, escriba `/quit` en Gemini CLI para salir y luego ábralo de nuevo.
Verá que el servidor GitHub MCP se está ejecutando y listo para usar.
![MCP](assets/gemini_cli_1/mcp.png)
Escriba el comando `/mcp`, y verá una lista de herramientas de GitHub.
![Mcp Commands](assets/gemini_cli_1/mcp_commands.png)