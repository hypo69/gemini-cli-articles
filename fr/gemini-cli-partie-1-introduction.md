## Gemini CLI : Introduction et premiers pas.

**Gemini CLI** est un outil qui fonctionne directement dans votre terminal, comprend votre base de code et vous aide √† corriger les erreurs avec des requ√™tes en langage naturel. C'est la r√©ponse de Google au Claude Code d'Anthropic.
Vous pouvez utiliser Gemini 1.5 Pro (lorsque vous atteignez la limite, l'outil passera √† Gemini 1.5 Flash) et sa fen√™tre de contexte de 1 million de jetons pour effectuer jusqu'√† 60 requ√™tes par minute et 1000 requ√™tes par jour, le tout gratuitement.

### Contenu
*   Comprendre et naviguer dans de grandes bases de code
*   D√©tecter et corriger les erreurs
*   √âcrire et tester du code
*   Outils Gemini CLI
*   Int√©gration de Google CLI avec MCP

### Principales fonctionnalit√©s de Gemini CLI :
*   **√âdition et refactoring :** Am√©liore et simplifie automatiquement votre code sous la direction de l'IA.
*   **D√©tection et correction d'erreurs :** Trouve les bogues et sugg√®re des correctifs.
*   **Compr√©hension du code :** Gemini CLI peut r√©sumer l'architecture, expliquer les r√¥les des modules ou cr√©er des organigrammes d'ex√©cution.
*   **G√©n√©ration de tests :** Cr√©e automatiquement des cas de test pour `pytest`
*   **Prise en charge de la documentation :** Vous pouvez cr√©er des documents markdown structur√©s, des journaux de modifications et des r√©ponses aux probl√®mes GitHub directement dans le terminal.
*   **Ex√©cution de commandes :** Gemini CLI peut ex√©cuter des commandes shell telles que `git`, `npm`, `pip` et autres, vous permettant de g√©rer des projets sans quitter le CLI.

---

### √âtape 1 : Pr√©requis

Pour commencer, installez Node.js (version 18 ou sup√©rieure). Vous pouvez t√©l√©charger le programme d'installation de votre choix ou ex√©cuter les commandes bash suivantes dans votre terminal :

```bash
# T√©l√©charger et installer nvm (Node Version Manager) :
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

# Initialiser nvm dans la session de terminal actuelle
. "$HOME/.nvm/nvm.sh"

# T√©l√©charger et installer Node.js (par exemple, la version 22) :
nvm install 22

# V√©rifier la version de Node.js :
node -v # Devrait afficher "v22.17.0" ou similaire

# V√©rifier la version de npm :
npm -v # Devrait afficher "10.9.2" ou similaire
```

> ‚ö†Ô∏è **Important pour les utilisateurs de Windows :**
> La commande `nvm` ci-dessus est pour **Linux/macOS** et **ne fonctionnera pas dans PowerShell ou cmd.exe**.
> Pour Windows, utilisez [nvm-windows](https://github.com/coreybutler/nvm-windows) en t√©l√©chargeant `nvm-setup.exe` depuis la section [Releases](https://github.com/coreybutler/nvm-windows/releases).
> Alternativement, vous pouvez installer WSL (Windows Subsystem for Linux) et ex√©cuter les commandes dans Ubuntu ou une autre distribution Linux.

---
### √âtape 2 : Configuration de Gemini CLI

#### √âtape 2.1 : Installation de Gemini CLI
Une fois Node.js et npm install√©s et v√©rifi√©s, installez Gemini CLI en ex√©cutant la commande suivante dans votre terminal :
```bash
npx https://github.com/google-gemini/gemini-cli
```
Ou utilisez `npm` pour l'installer globalement :
```bash
npm install -g @google/gemini-cli
gemini
```
Apr√®s l'installation, tapez `gemini` dans le terminal pour acc√©der √† l'outil.

#### √âtape 2.2 : Authentification
Vous pouvez utiliser votre compte Google personnel pour vous authentifier. Cela vous donnera jusqu'√† 60 requ√™tes par minute et 1000 requ√™tes par jour lors de l'utilisation de Gemini.
![First Run](assets/gemini_cli_1/auth.png)

Dans ce guide, j'ai utilis√© **Se connecter avec Google**, mais vous pouvez √©galement utiliser une **cl√© API** (d√©finie comme variable d'environnement ou dans un fichier `.env`) ou vous authentifier via **Vertex AI**.

Pour g√©n√©rer une nouvelle cl√© API, connectez-vous √† **AI Studio** avec votre compte Google et cliquez sur "Cr√©er une cl√© API".
```bash
# D√©finir la cl√© comme variable d'environnement
export GEMINI_API_KEY="Your_API_Key"

# Ou cr√©er un fichier .env
GEMINI_API_KEY="Your_API_Key"
```
Vous pouvez utiliser la commande `/auth` dans la zone de texte pour changer de m√©thode d'authentification si n√©cessaire.

---

### √âtape 3 : Configuration d'un projet dans Gemini CLI
![Start](assets/gemini_cli_1/start.png)
Une fois le CLI en cours d'ex√©cution, nous pouvons commencer √† interagir avec Gemini depuis le terminal. Il y a deux fa√ßons de travailler avec un projet.

#### 1. D√©marrer un nouveau projet
Pour d√©marrer un projet √† partir de z√©ro, ex√©cutez les commandes suivantes :
```bash
cd new-project/
gemini
```
√Ä l'int√©rieur du CLI, utilisez une invite pour r√©soudre le probl√®me qui vous int√©resse, par exemple :
> √âcrivez le code de l'encodeur pour un transformateur √† partir de z√©ro.
![Example 1](assets/gemini_cli_1/example_1.png)
Donnez la permission d'√©crire des fichiers :
![File](assets/gemini_cli/file.png)

#### 2. Travailler avec un projet existant
Si vous avez d√©j√† une base de code, vous pouvez travailler avec elle en ex√©cutant les commandes suivantes :
```bash
git clone https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo
cd Google-Agent-Development-Kit-Demo
gemini
```
√Ä l'int√©rieur du CLI, utilisez une invite, par exemple :
> Fournissez-moi un r√©sum√© de toutes les modifications apport√©es √† la base de code au cours du dernier mois.

---

### √âtape 4 : Exp√©rimentation avec Gemini CLI
√Ä titre d'exemple, j'utiliserai le projet **[Planificateur de voyage üåçüõ´ bas√© sur ADK](https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo)**.
Avec Gemini CLI, je vais vous montrer comment :
1.  explorer la base de code
2.  d√©tecter un bogue ou un probl√®me sur GitHub ou dans un fichier
3.  refactoriser le code et g√©n√©rer des tests unitaires
4.  cr√©er un rapport markdown des modifications apport√©es
5.  visualiser la base de code en g√©n√©rant un organigramme

#### Exploration et compr√©hension de la base de code
Commen√ßons par demander √† Gemini d'explorer et d'expliquer la base de code.

**Invite :** `Explorez le r√©pertoire actuel et d√©crivez l'architecture du projet.`

Gemini CLI renverra un r√©sum√© structur√© expliquant l'architecture :
*   **Interface utilisateur :** Une application Streamlit (`travel_ui.py`) fournit une interface pour l'interaction.
*   **Orchestration :** `host_agent` agit comme un coordinateur central.
*   **Agents sp√©cialis√©s :** `flight_agent`, `stay_agent`, `activities_agent` pour la recherche de vols, d'h√¥tels et de divertissements.
*   **Communication :** Les agents communiquent entre eux via une API RESTful sur FastAPI.
*   **Composants partag√©s :** `shared/schemas.py` d√©finit des structures de donn√©es communes.

Cela vous aidera √† vous rep√©rer sans lire chaque fichier manuellement.

#### Analyse et r√©solution d'un probl√®me GitHub
Explorons quelques probl√®mes ouverts du r√©f√©rentiel GitHub.

**Invite :** `Voici un probl√®me GitHub : [@search https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo/issues/1]. Analysez la base de code et proposez un plan de correction en 3 √©tapes. Quels fichiers/fonctions doivent √™tre modifi√©s ?`

Gemini CLI a enqu√™t√© sur le probl√®me :
*   En utilisant la fonction `@search`, il a r√©cup√©r√© des donn√©es de GitHub.
*   A identifi√© la cause premi√®re comme une erreur de s√©rialisation JSON (dans ce cas, la fonction asynchrone `create_session()` n'a pas √©t√© appel√©e avec `await`).
*   A sugg√©r√© des modifications et une gestion des r√©ponses dans plusieurs fichiers.

Ensuite, le CLI attend une entr√©e de l'utilisateur pour √©valuer les modifications. Si l'utilisateur est d'accord, il appliquera les modifications sugg√©r√©es.

#### Impl√©mentation et test du correctif
Impl√©mentons et testons maintenant les correctifs sugg√©r√©s par Gemini.

**Invite :** `√âcrivez un test unitaire pour cette modification dans pytest dans le fichier test_shared.py.`

Gemini CLI :
*   A ins√©r√© `json.dumps()` avant d'envoyer la charge utile de la t√¢che.
*   A cr√©√© `test_agents.py` pour ajouter des tests unitaires.
*   A ajout√© un nouveau cas de test pour v√©rifier le sch√©ma et le transfert des messages d'agent imbriqu√©s.

#### G√©n√©ration de la documentation
Maintenant que les correctifs ont √©t√© apport√©s, r√©sumons les modifications et √©crivons-les en Markdown dans un fichier `.txt`.

**Invite :** `R√©digez un r√©sum√© markdown du bogue, du correctif et de la couverture des tests. Formatez-le comme une entr√©e de journal des modifications sous la version "v0.2.0".`

Ensuite, pour enregistrer le r√©sum√© dans un document, j'ai utilis√© l'invite suivante :

**Invite :** `Enregistrez ce r√©sum√© dans un fichier .txt et nommez-le summary.txt`

Gemini CLI utilise l'outil `WriteFile` pour enregistrer le fichier `summary.txt` dans le r√©pertoire du projet.

#### G√©n√©ration d'un organigramme √† l'aide de MCP
Cette section d√©veloppe les exp√©riences pr√©c√©dentes o√π j'explore comment Gemini CLI utilise le **Protocole de contexte de mod√®le (MCP)** pour maintenir des r√©sum√©s au niveau des fichiers et un historique des t√¢ches entre les invites. Cela donne √† Gemini une "m√©moire de travail" au sein d'une session.

**Invite :** `G√©n√©rez un organigramme qui montre comment les agents communiquent via A2A (agent √† agent) et comment main.py g√®re le syst√®me. Mettez en surbrillance l'endroit o√π le probl√®me s'est produit et comment il a √©t√© r√©solu.`

Cette visualisation a √©t√© rendue possible par la m√©moire persistante de Gemini, qui a conserv√© le contexte complet de notre correctif de bogue pr√©c√©dent et de la structure de l'agent sans avoir √† recharger les fichiers.

### Outils Gemini CLI disponibles
L'appel de la commande `/tools` dans Gemini CLI affichera une liste des outils disponibles qui peuvent √™tre utilis√©s pour effectuer diverses t√¢ches, telles que la modification de code, la g√©n√©ration de tests, la cr√©ation de documentation, et bien plus encore.
![Tools](assets/gemini_cli_1/tools.png)

**ReadFolder (ls)**
Liste les fichiers et les dossiers d'un r√©pertoire - analogue √† la commande `ls` en ligne de commande.

**ReadFile (read-file)**
Lit le contenu complet d'un seul fichier, ce qui est utile pour cr√©er des r√©sum√©s ou des analyses.

**ReadManyFiles (read-many-files)**
Lit plusieurs fichiers √† la fois, g√©n√©ralement par un mod√®le (par exemple, tous les fichiers `.js`).

**FindFiles (glob)**
Recherche des fichiers par un mod√®le (par exemple, trouver tous les fichiers `config.json` dans votre projet).

**SearchText (grep)**
Recherche du texte dans les fichiers, par exemple, pour trouver tous les commentaires `TODO`.

**Edit (edit)**
Applique les modifications de code √† l'aide d'un `diff`. Gemini affiche un aper√ßu des modifications et demande une confirmation avant de les appliquer.

**WriteFile (write-file)**
Cr√©e de nouveaux fichiers (par exemple, `README.md`) avec le contenu fourni par l'utilisateur.

**Shell (shell)**
Ex√©cute des commandes directement dans le terminal si vous les pr√©fixez avec `!` (par exemple, `!npm test`).

**WebFetch (web-fetch)**
T√©l√©charge du contenu depuis le Web (HTML ou JSON), permettant √† Gemini d'analyser des donn√©es externes.

**GoogleSearch (web-search)**
Effectue une recherche Google pour baser les r√©ponses sur des informations r√©elles (par exemple, pour trouver une explication √† une erreur).

**Save Memory (memoryTool)**
Enregistre des faits ou des pr√©f√©rences pendant une session (par exemple, "je pr√©f√®re async/await") pour am√©liorer la coh√©rence et la coh√©sion des r√©ponses.

### Fonctionnalit√©s avanc√©es

Vous pouvez ajouter des instructions sp√©ciales pour l'IA pour un projet sp√©cifique en
cr√©ant un fichier `GEMINI.md` dans le r√©pertoire racine de votre projet.
√Ä l'int√©rieur de ce fichier, vous pouvez d√©finir les r√®gles du projet,
les styles de code et les outils que l'agent doit utiliser. Cela garantit que le code g√©n√©r√© respecte les normes de votre projet.

[Exemple d'instruction syst√®me](https://github.com/hypo69/hypotez/blob/master/src/endpoints/hypo69/code_assistant/instructions/CODE_RULES.EN.MD)

### Int√©gration de Google CLI avec MCP

Pour la plupart des t√¢ches quotidiennes, les outils int√©gr√©s seront suffisants. Mais que se passe-t-il si vous voulez que Gemini CLI fasse quelque chose de tr√®s sp√©cialis√©, comme interagir avec des API sp√©cifiques ou utiliser un mod√®le sp√©cialis√© (disons, un g√©n√©rateur d'images ou un outil d'analyse de s√©curit√©) ? C'est l√† que MCP (Model Context Protocol) entre en jeu.

En substance, MCP est une norme ouverte qui permet aux d√©veloppeurs d'ajouter de nouveaux outils et de nouvelles fonctionnalit√©s √† l'IA en ex√©cutant un serveur avec lequel le CLI peut interagir. Dans Gemini CLI, vous pouvez configurer des "serveurs MCP" dans un fichier de param√®tres JSON, et le CLI les traitera comme des outils suppl√©mentaires qu'il peut utiliser.

#### Comment configurer un serveur MCP dans Google CLI

√Ä titre d'exemple, je vais vous montrer comment configurer un serveur MCP pour GitHub dans Gemini CLI.

√Ä l'int√©rieur de votre dossier de projet, cr√©ez un dossier √† l'aide de la commande :

```bash
mkdir -p .gemini && touch .gemini/settings.json
```
Remplissez le fichier avec ce code :
```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": { "GITHUB_PERSONAL_ACCESS_TOKEN": "[YOUR-TOKEN]" }
    }
  }
}
```
[instructions sur la fa√ßon d'obtenir un jeton](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic)
Apr√®s cela, tapez `/quit` dans Gemini CLI pour quitter, puis ouvrez-le √† nouveau.
Vous verrez que le serveur MCP GitHub est en cours d'ex√©cution et pr√™t √† √™tre utilis√©.
![MCP](assets/gemini_cli_1/mcp.png)
Entrez la commande `/mcp`, et vous verrez une liste d'outils GitHub.
![Mcp Commands](assets/gemini_cli_1/mcp_commands.png)