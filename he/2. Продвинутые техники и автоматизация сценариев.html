## Gemini CLI: טכניקות מתקדמות ואוטומציה של תרחישים.

בחלק הראשון, כיסינו את היסודות: התקנה, אימות וביצוע פקודות בודדות. כעת נעבור לשלב הבא. בחלק זה, נלמד את Gemini CLI לבצע תרחישים מורכבים מרובי שלבים שניתן לשמור, לעשות בהם שימוש חוזר ולשתף עם הצוות. זה יהפוך את הכלי מעוזר פשוט למנוע אוטומציה חזק.

### מנגנון ביצוע תרחישים

הרעיון המרכזי הוא להשתמש בקבצי `.md` כ"מתכונים" או "תרחישים" עבור Gemini. בתוך קובץ כזה, אנו מתארים בשפה טבעית את רצף הפעולות שה-AI צריך לבצע.

כדי להפעיל תרחיש, נשתמש בכלי המובנה `ReadFile`. פשוט נבקש מ-Gemini לקרוא את הקובץ עם ההוראות ולבצע אותן.

**פקודה ראשית להפעלת כל תרחיש:**
```
> קרא ובצע הוראות מהקובץ 'שם_התרחיש.md'
```

כעת נבחן כמה תרחישים שימושיים.

צור ספריית `scenarios`.
```bash
/path/to/gemini-cli > mkdir scenarios
```

בה נאחסן את התרחישים שלנו.


### תרחיש: "ביקורת מאגר Git"

משימה זו מוכרת לכל מפתח: לפני תחילת העבודה, עליך לבדוק את המצב הנוכחי של הפרויקט. בואו ניצור תרחיש שיעשה זאת עבורנו.

1.  **בספריית `scenarios`, צור את הקובץ `git-health-check.md`** עם התוכן הבא:

    ```markdown
    אתה מהנדס Git מנוסה. משימתך היא לבצע ביקורת מלאה של המאגר הנוכחי.

    בצע את השלבים הבאים בקפדנות לפי הסדר והמתן לאישור שלי עבור כל פקודה:

    1.  **בדוק סטטוס:** הצג לי את סטטוס המאגר הנוכחי כדי לראות קבצים לא במעקב או ששונו. הצע את הפקודה `!git status`.
    2.  **אחזר עדכונים:** קבל את השינויים האחרונים מהשרת המרוחק, אך אל תחיל אותם. הצע את הפקודה `!git fetch origin`.
    3.  **השווה ענפים:** הצג לי את ההבדל בין ענף ה-`main` המקומי שלי לבין ה-`origin/main` המרוחק. הצע את הפקודה `!git log main..origin/main --oneline`.
    4.  **מצא קבצים גדולים:** מצא את 5 הקבצים הגדולים ביותר בפרויקט שאינם נמצאים ב-`.git`. הצע את הפקודה `!find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5`.
    5.  **סכם:** לבסוף, תאר בקצרה את מצב המאגר בהתבסס על הנתונים שהתקבלו.
    ```

2.  **הפעל את התרחיש ב-Gemini CLI:**

    ```
    > קרא ובצע את התרחיש 'git-health-check.md'
    ```

![1](assets/1.png)


למעשה, אין מאגר בספרייה זו, Gemini יציע ליצור מאגר חדש.
Gemini CLI יתקן באופן עצמאי שגיאות במהלך יצירת המאגר, לדוגמה, אם שכחת לאתחל אותו, הוא יציע לעשות זאת,
וכן שגיאות נוכחיות במהלך ביצוע התרחיש


## שלב 1: בדיקת סטטוס

![2](assets/2.png)

תגובת Gemini:
```text
>✦ אני מהנדס Git מנוסה. מתחיל את ביקורת המאגר שלך.
> שלב 1: בדיקת סטטוס
>כדי לבדוק את סטטוס המאגר הנוכחי ולראות קבצים לא במעקב או ששונו, אבצע את הפקודה `git status`.
```
מבצע פקודת `git status`...
![3](assets/3.png)

תגובת Gemini:
```text
✦ שגיאה: C:\Users\user\Documents\repos אינו מאגר Git. 

  אנא ציין באיזו תת-ספרייה עלי להריץ את הביקורת. לדוגמה, public_repositories.
```
אנו מבקשים ליצור מאגר חדש.
![4](assets/4.png)
תגובת Gemini:
```text
✦ מצוין, מאגר Git נוצר. כעת אוכל להמשיך בביקורת.


  מבצע git status כדי לבדוק קבצים לא במעקב.
```
![5](assets/5.png)

...


![6](assets/6.png)

תגובת Gemini:
```text
✦ ישנם קבצים ותיקיות רבים לא במעקב במאגר. כדי להמשיך, עלי להוסיף אותם לאינדקס. אוסיף את כל הקבצים.
```

![7](assets/7.png)
...
![8](assets/8.png)

אירעה שגיאה במהלך ביצוע הפקודה
```text
error: pathspec 'commit"' did not match any file(s) known to git
```
תגובת Gemini:
```text
✦ נראה שאירעה שגיאת גרשיים בפקודה. אנסה שוב באמצעות גרשיים בודדים עבור הודעת הקומיט.
```

![9](assets/9.png)
![10](assets/10.png)
הפעם זה עבד!

תגובת Gemini:
```text
✦ מצוין, הקומיט הראשון נוצר בהצלחה. כעת אמחק את הקובץ הזמני עם הודעת הקומיט.
```
כעת gemini ימחק את הקובץ הזמני עם הודעת הקומיט.

gemini cli מיישם ברצף את הפקודה הרלוונטית ('rm','del')

![11](assets/11.png)




### שלב 2: אחזור עדכונים
מכיוון שהמאגר המרוחק אינו קיים, gemini cli יקבל שגיאה.
שים לב שהוא עצמו מצפה לשגיאה

![12](assets/12.png)


### שלב 3: השוואת ענפים

גם כאן תהיה שגיאה, מכיוון שענף ה-`main` אינו קיים.
![13](assets/13.png)


### שלב 4: מציאת קבצים גדולים

![14](assets/14.png)
תגובת Gemini:
```text
הפקודה `find` לא עבדה מכיוון שב-Windows עליך להשתמש ב-`dir`. Gemini יתקן את השגיאה בעצמו ויציע את הפקודה הנכונה.

בהמשך, gemini cli מנמק מה לעשות הלאה:
✦ THINK: המשתמש רוצה שאמצא את 5 הקבצים הגדולים ביותר בפרויקט.
  הפקודה הקודמת find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5 נכשלה מכיוון ש-find, sort ו-head
  אינם פקודות Windows מקוריות. עלי להשתמש במקביל PowerShell. 

   1. קבל את כל הקבצים: Get-ChildItem -Recurse -File
   2. אל תכלול ספריית .git: Where-Object { $_.FullName -notlike "*\\.git\\*" }
   3. מיין לפי גודל (יורד): Sort-Object -Property Length -Descending
   4. בחר את 5 הראשונים: Select-Object -First 5
   5. פורמט את הפלט: ForEach-Object { "{0} {1}" -f $_.Length, $_.FullName }

  בואו נשלב אותם לפקודת PowerShell אחת. נראה ש-find ו-head אינם זמינים בסביבת Windows שלך. אשתמש ב-PowerShell,
  כדי לבצע את אותה משימה.
```
![15](assets/15.png)

כישלון שוב

gemini cli ממשיך לנמק מה לעשות הלאה:
תגובת Gemini:
```text

✦ THINK: המשתמש רוצה למצוא את 5 הקבצים הגדולים ביותר.
  פקודת PowerShell עדיין לא מבוצעת כהלכה. נראה שהצינור | ותווים מיוחדים מתפרשים באופן שגוי על ידי ה-
  shell כאשר הם מועברים כמחרוזת פקודה אחת.

  אנסה לבצע את הפקודה על ידי שמירת הסקריפט תחילה לקובץ ולאחר מכן ביצוע הקובץ באמצעות PowerShell.

   1. צור קובץ סקריפט PowerShell (find_large_files.ps1).
   2. תוכן הסקריפט יהיה: Get-ChildItem -Recurse -File | Where-Object { $_.FullName -notlike "*\\.git\\*" } | Sort-Object
      -Property Length -Descending | Select-Object -First 5 | Format-Table Length, FullName -AutoSize
   3. בצע את הסקריפט באמצעות powershell -File find_large_files.ps1.
   4. מחק את קובץ הסקריפט. נראה שהעברת פקודות מורכבות ל-PowerShell ישירות גורמת לבעיות. אצור קובץ סקריפט זמני
      PowerShell, אבצע אותו, ולאחר מכן אמחק אותו.

```
![16](assets/16.png)

הפעם זה עבד!


### שלב 5: סיכום
gemini cli מסכם:
```text
 מצב מאגר: 

   * מאגר מקומי: אותחל, וכל הקבצים בתיקיית השורש C:\Users\user\Documents\repos נוספו לקומיט הראשון.
   * מאגר מרוחק: לא מוגדר. אין מקור מרוחק, ולכן לא ניתן לקבל עדכונים או להשוות ענפים.
   * קבצים גדולים: נמצאו מספר קבצים גדולים מאוד, בעיקר בתת-ספריות venv ו-public_repositories. הגדולים שבהם הם
     ספריות .lib וארכיוני .zip. מומלץ להוסיף נתיבים המכילים קבצים בינאריים גדולים (לדוגמה, venv, *.zip) לקובץ .gitignore,
     כדי למנוע את הכללתם במאגר.

  הביקורת הושלמה.
```
![17](assets/17.png)


### תרחיש: "ניקוי סביבת Docker"

Docker צובר תמונות, מכולות ורשתות רבות מיותרות לאורך זמן. תרחיש זה יעזור לנקות הכל בבטחה.

1.  **צור את הקובץ `docker-cleanup.md`**:

    ```markdown
    אתה מהנדס DevOps האחראי על ניקיון המערכת. משימתך היא לנקות בבטחה את סביבת Docker.

    המשך צעד אחר צעד:

    1.  **הצג מכולות פועלות:** ראשית, רשום את כל המכולות הפעילות כדי שאוכל לוודא שאני לא עוצר משהו חשוב. הצע `!docker ps`.
    2.  **עצור את כל המכולות:** לאחר אישורי, הצע פקודה לעצור את כל המכולות הפועלות. פקודה: `!docker stop $(docker ps -q)`.
    3.  **ניקוי גלובלי:** כעת בצע ניקוי מערכת מלא של תמונות "תלויות" (dangling), מכולות עצורות, רשתות לא בשימוש ומטמון בנייה. הצע את הפקודה הבטוחה והיעילה ביותר `!docker system prune -af`.
    4.  **דוח:** לאחר הביצוע, דווח כמה מקום שוחרר, בהתבסס על פלט הפקודה האחרונה.
    ```

2.  **הפעל את התרחיש ב-Gemini CLI:**

    ```
    > קרא ובצע את תרחיש ניקוי Docker מהקובץ 'docker-cleanup.md'
    ```
**תוצאה:** Gemini ידריך אותך בתהליך ניקוי בטוח, ויבקש אישור בכל שלב קריטי.

---


### תרחיש: "הפעלת יישומי מערכת"

כפי שמוצג בדוגמה, Gemini מטפל בהפעלת יישומים בצורה מושלמת. בואו נפורמל זאת לתרחיש פשוט עבור Windows.

1.  **צור את הקובץ `open-windows-tools.md`**:

    ```markdown
    אתה מנהל מערכת Windows. משימתך היא לפתוח כלי עזר מערכתיים לפי בקשה.

    - אם אבקש "מתזמן משימות", הצע להפעיל `!taskschd.msc`.
    - אם אבקש "עורך רישום", הזהר מפני הסכנה והצע להפעיל `!regedit`.
    - אם אבקש "צג משאבים", הצע להפעיל `!resmon`.
    - אם אבקש "מנהל משימות", הצע להפעיל `!taskmgr`.
    - אם אבקש "שורת פקודה", הצע להפעיל `!cmd`.
    - אם אבקש "סייר", הצע להפעיל `!explorer`.
    באופן דומה עבור כלי עזר אחרים.
    ```

2.  **הפעל את התרחיש ותן את הפקודה:**

    ```
    > השתמש בהוראות מ-'open-windows-tools.md'. פתח את מתזמן המשימות.
    ```
**תוצאה:** Gemini יבין את ההקשר מהקובץ ואת בקשתך, ולאחר מכן יציע לבצע את הפקודה הנדרשת.

> **תגובת Gemini:**
> ```text
> אוקיי, פותח את מתזמן המשימות.
> 
> לבצע `!taskschd.msc`? (y/n)
> ```
לאחר אישור, כלי העזר הסטנדרטי של Windows ייפתח על המסך שלך.
```