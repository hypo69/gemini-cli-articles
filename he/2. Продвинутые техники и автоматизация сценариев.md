## Gemini CLI: Advanced Techniques and Scenario Automation.

In the first part, we covered the basics: installation, authentication, and executing single commands. Now we'll move to the next stage. In this part, we'll teach Gemini CLI to perform complex multi-step scenarios that can be saved, reused, and shared with the team. This will turn the tool from a simple assistant into a powerful automation engine.

### Scenario Execution Mechanism

The core idea is to use `.md` files as "recipes" or "scenarios" for Gemini. Within such a file, we describe in natural language the sequence of actions the AI should perform.

To run a scenario, we'll use the built-in `ReadFile` tool. We'll simply ask Gemini to read the instructions file and execute them.

**The main command to run any scenario:**
```
> Read and execute instructions from the file 'scenario_name.md'
```

Now, let's look at some useful scenarios.

Create a `scenarios` directory.
```bash
/path/to/gemini-cli > mkdir scenarios
```

Where we will save our scenarios.


### Scenario: "Git Repository Health Check"

This task is familiar to every developer: before starting work, you need to check the current state of the project. We will create a scenario that will do this for us.

1.  **In the `scenarios` directory, create a file `git-health-check.md`** with the following content:

    ```markdown
    You are an experienced Git engineer. Your task is to perform a full audit of the current repository.
    
    Follow these steps strictly in order and wait for my confirmation for each command:
    
    1.  **Check Status:** Show me the current status of the repository to see untracked or modified files. Suggest the command `!git status`.
    2.  **Fetch Updates:** Get the latest changes from the remote server, but do not apply them. Suggest the command `!git fetch origin`.
    3.  **Compare Branches:** Show me the difference between my local `main` branch and the remote `origin/main` branch. Suggest the command `!git log main..origin/main --oneline`.
    4.  **Find Large Files:** Find the 5 largest files in the project that are not in `.git`. Suggest the command `!find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5`.
    5.  **Summarize:** At the end, briefly describe the repository's status based on the obtained data.
    ```

2.  **Run the scenario in Gemini CLI:**

    ```
    > Read and execute the scenario 'git-health-check.md'
    ```

<p dir="rtl"><img src="assets/1.png" alt="1"></p>


Actually, there is no repository in this directory, Gemini will suggest creating a new repository.
Gemini CLI will automatically correct errors during repository creation, for example, if you forgot to initialize it, it will suggest you do so, 
and also current errors during scenario execution.

## Step 1: Status Check

<p dir="rtl"><img src="assets/2.png" alt="2"></p>

Gemini's response:
```text
>✦ I am an experienced Git engineer. I'll start by auditing your repository.
> Step 1: Status Check
>To check the current status of the repository and see untracked or modified files, I will execute the `git status` command.
```
Executing the command <span dir="ltr">`git status`</span>...
<p dir="rtl"><img src="assets/3.png" alt="3"></p>

Gemini's response:
```text
✦ Error: C:\Users\user\Documents\repos is not a Git repository.

  Please specify which subdirectory I should perform the audit in. For example, public_repositories.
```
We request to create a new repository.
<p dir="rtl"><img src="assets/4.png" alt="4"></p>
Gemini's response:
```text
✦ Excellent, a Git repository has been created. I can now proceed with the audit.

  Executing git status to check for untracked files.
```
<p dir="rtl"><img src="assets/5.png" alt="5"></p>

...

<p dir="rtl"><img src="assets/6.png" alt="6"></p>

Gemini's response:
```text
✦ The repository has many untracked files and directories. To proceed, I need to add them to the index. I will add all files.
```

<p dir="rtl"><img src="assets/7.png" alt="7"></p>
...
<p dir="rtl"><img src="assets/8.png" alt="8"></p>

An error occurred during command execution
```text 
error: pathspec 'commit"' did not match any file(s) known to git
```
Gemini's response:
```text
✦ It seems there was an error with the quotes in the command. I will try again, using single quotes for the commit message.
```

<p dir="rtl"><img src="assets/9.png" alt="9"></p>
<p dir="rtl"><img src="assets/10.png" alt="10"></p>
This time it worked!

Gemini's response:
```text
✦ Excellent, the first commit was created successfully. I will now delete the temporary file with the commit message.
```
Now Gemini will delete the temporary file with the commit message.

gemini cli sequentially implements the relevant command (<span dir="ltr">'rm','del'</span>)

<p dir="rtl"><img src="assets/11.png" alt="11"></p>




### Step 2: Fetch Updates

Since the remote repository does not exist, gemini cli will receive an error. 
Note that it itself expects an error.

<p dir="rtl"><img src="assets/12.png" alt="12"></p>

### Step 3: Compare Branches

There will be an error here too, because the <span dir="ltr">`main`</span> branch does not exist.
<p dir="rtl"><img src="assets/13.png" alt="13"></p>

### Step 4: Find Large Files

<p dir="rtl"><img src="assets/14.png" alt="14"></p>
Gemini's response:
```text
The `find` command did not work because on Windows, `dir` must be used. Gemini will correct the error and suggest the correct command.

Subsequently, gemini cli analyzes the following actions:
✦ THINK: The user wants me to find the 5 largest files in the project.
  The previous command find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5 failed because find, sort, and head
  are not native Windows commands. I need to use a PowerShell equivalent.

   1. Get all files: Get-ChildItem -Recurse -File
   2. Exclude .git directory: Where-Object { $_.FullName -notlike "*\.git\*" }
   3. Sort by size (descending): Sort-Object -Property Length -Descending
   4. Select the top 5: Select-Object -First 5
   5. Format the output: ForEach-Object { "{0} {1}" -f $_.Length, $_.FullName }

  Let's combine these into a single PowerShell command. It seems that passing complex commands directly to PowerShell is causing problems. I will create a temporary PowerShell script file, execute it, and then delete it.
```
<p dir="rtl"><img src="assets/15.png" alt="15"></p>

Failure again.

gemini cli continues to think about what to do next:
```text
 
✦ THINK: The user wants to find the 5 largest files.
  The PowerShell command is still not executing correctly. It seems that the pipe | and special characters are being misinterpreted by the
  shell when passed as a single command string.

  I will try to execute the command by first saving the script to a file and then executing the file with PowerShell.

   1. Create a PowerShell script file (find_large_files.ps1).
   2. The content of the script will be: Get-ChildItem -Recurse -File | Where-Object { $_.FullName -notlike "*\.git\*" } | Sort-Object
      -Property Length -Descending | Select-Object -First 5 | Format-Table Length, FullName -AutoSize
   3. Execute the script using powershell -File find_large_files.ps1.
   4. Delete the script file. It seems that passing complex commands to PowerShell directly causes problems. I will create a temporary PowerShell script file, execute it, and then delete it.
```
<p dir="rtl"><img src="assets/16.png" alt="16"></p>

This time everything worked!

### Step 5: Summary
gemini cli summarizes:
```text
 Repository Status:

   * Local Repository: Initialized, and all files in the root directory C:\Users\user\Documents\repos have been added to the first commit.
   * Remote Repository: Not configured. There is no remote origin, so updates cannot be fetched or branches compared.
   * Large Files: Several very large files were found, mainly in the venv and public_repositories subdirectories. The largest among them are
     .lib directories and .zip archives. It is recommended to add paths containing large binary files (e.g., venv, *.zip) to the .gitignore file,
     to prevent their inclusion in the repository.

  The audit is complete.
```
<p dir="rtl"><img src="assets/17.png" alt="17"></p>
<hr>
### Scenario: "Docker Environment Cleanup"

Docker accumulates many unnecessary images, containers, and networks over time. This scenario will help clean everything up safely.

1.  **Create a file `docker-cleanup.md`**:
    ```markdown
    You are a DevOps engineer, responsible for system cleanup. Your task is to safely clean up the Docker environment.
    
    Follow the steps:
    
    1.  **Show Running Containers:** First, display a list of all running containers so I can confirm I'm not stopping anything important. Suggest `!docker ps`.
    2.  **Stop All Containers:** After my confirmation, suggest a command to stop all running containers. Command: `!docker stop $(docker ps -q)`.
    3.  **Global Cleanup:** Now perform a full system cleanup of dangling images, stopped containers, unused networks, and the build cache. Suggest the safest and most efficient command: `!docker system prune -af`.
    4.  **Report:** After execution, report how much space was freed, based on the output of the last command.
    ```

2.  **Run the scenario in Gemini CLI:**

    ```
    > Read and execute the Docker cleanup scenario from the file 'docker-cleanup.md'
    ```
**Result:** Gemini will guide you through a safe cleanup process, asking for confirmation at each critical step.


### Scenario: "Running System Applications"

As demonstrated in the example, Gemini handles running applications excellently. Let's formalize this into a simple scenario for Windows.

1.  **Create a file `open-windows-tools.md`**:
    ```markdown
    You are a Windows system administrator. Your task is to open system utilities as requested.
    
    - If I ask for "Task Scheduler", suggest running `!taskschd.msc`.
    - If I ask for "Registry Editor", warn about the danger and suggest running `!regedit`.
    - If I ask for "Resource Monitor", suggest running `!resmon`.
    - If I ask for "Task Manager", suggest running `!taskmgr`.
    - If I ask for "Command Prompt", suggest running `!cmd`.
    - If I ask for "File Explorer", suggest running `!explorer`.
    Similarly for other utilities.
    ```

2.  **Run the scenario and give the command:**

    ```
    > Use instructions from 'open-windows-tools.md'. Open Task Scheduler.
    ```
**Result:** Gemini will understand the context from the file and your request, then suggest executing the required command.

> **Gemini's response:**
> ```text
> Okay, I am opening Task Scheduler.
>
> Execute `!taskschd.msc`? (y/n)
> ```
After confirmation, the standard Windows utility will open on your screen.
