## Gemini CLI: טכניקות מתקדמות ואוטומציה של תרחישים.

בחלק הראשון, כיסינו את היסודות: התקנה, אימות וביצוע פקודות בודדות. כעת נעבור לשלב הבא. בחלק זה, נלמד את Gemini CLI לבצע תרחישים מורכבים מרובי שלבים שניתן לשמור, לעשות בהם שימוש חוזר ולשתף עם הצוות. זה יהפוך את הכלי מעוזר פשוט למנוע אוטומציה חזק.

### מנגנון ביצוע תרחישים

הרעיון המרכזי הוא להשתמש בקבצי `.md` כ"מתכונים" או "תרחישים" עבור Gemini. בתוך קובץ כזה, אנו מתארים בשפה טבעית את רצף הפעולות שה-AI צריך לבצע.

כדי להפעיל תרחיש, נשתמש בכלי המובנה `ReadFile`. פשוט נבקש מ-Gemini לקרוא את קובץ ההוראות ולבצע אותן.

**הפקודה העיקרית להפעלת כל תרחיש:**
<pre dir="rtl">```
> קרא ובצע את ההוראות מהקובץ 'שם_התרחיש.md'
```</pre>

כעת, בואו נסתכל על כמה תרחישים שימושיים.

צור תיקיית `scenarios`.
```bash
/path/to/gemini-cli > mkdir scenarios
```

בה נשמור את התרחישים שלנו.


### תרחיש: "ביקורת מאגר Git"

משימה זו מוכרת לכל מפתח: לפני תחילת העבודה, עליך לבדוק את המצב הנוכחי של הפרויקט. ניצור תרחיש שיעשה זאת עבורנו.

1.  **בתיקיית `scenarios` צור קובץ `git-health-check.md`** עם התוכן הבא:

    ```markdown
    אתה מהנדס Git מנוסה. משימתך היא לבצע ביקורת מלאה של המאגר הנוכחי.
    
    בצע את השלבים הבאים בקפדנות לפי הסדר והמתן לאישור שלי עבור כל פקודה:
    
    1.  **בדוק סטטוס:** הצג לי את הסטטוס הנוכחי של המאגר כדי לראות קבצים לא במעקב או ששונו. הצע את הפקודה `!git status`.
    2.  **בקש עדכונים:** קבל את השינויים האחרונים מהשרת המרוחק, אך אל תחיל אותם. הצע את הפקודה `!git fetch origin`.
    3.  **השווה ענפים:** הצג לי את ההבדל בין הענף המקומי שלי `main` לענף המרוחק `origin/main`. הצע את הפקודה `!git log main..origin/main --oneline`.
    4.  **מצא קבצים גדולים:** מצא את 5 הקבצים הגדולים ביותר בפרויקט שאינם נמצאים ב-`.git`. הצע את הפקודה `!find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5`.
    5.  **סכם:** בסיום, תאר בקצרה את מצב המאגר על בסיס הנתונים שהתקבלו.
    ```

2.  **הפעל את התרחיש ב-Gemini CLI:**

    <pre dir="rtl">```
    > קרא ובצע את התרחיש 'git-health-check.md'
    ```</pre>

<p dir="rtl"><img src="assets/1.png" alt="1"></p>


למעשה, אין מאגר בתיקייה זו, Gemini יציע ליצור מאגר חדש.
Gemini CLI יתקן אוטומטית שגיאות במהלך יצירת המאגר, לדוגמה, אם שכחת לאתחל אותו, הוא יציע לך לעשות זאת, 
וכן שגיאות נוכחיות במהלך ביצוע התרחיש.

## שלב 1: בדיקת סטטוס

<p dir="rtl"><img src="assets/2.png" alt="2"></p>

תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">&gt;✦ אני מהנדס Git מנוסה. אני מתחיל בביקורת המאגר שלך.
&gt; שלב 1: בדיקת סטטוס
&gt;כדי לבדוק את הסטטוס הנוכחי של המאגר ולראות קבצים לא במעקב או ששונו, אבצע את הפקודה `git status`.</code></pre>
<p dir="rtl">ביצוע הפקודה `git status`...</p>
<p dir="rtl"><img src="assets/3.png" alt="3"></p>

תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">✦ שגיאה: C:\Users\user\Documents\repos אינו מאגר Git.

  אנא ציין באיזו מתיקיות המשנה עלי להפעיל את הביקורת. לדוגמה, public_repositories.</code></pre>
<p dir="rtl">אנו מבקשים ליצור מאגר חדש.</p>
<p dir="rtl"><img src="assets/4.png" alt="4"></p>
<p dir="rtl">תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">&gt;✦ מצוין, מאגר Git נוצר. כעת אוכל להמשיך בביקורת.


  מבצע git status כדי לבדוק נוכחות של קבצים לא במעקב.</code></pre>
<p dir="rtl"><img src="assets/5.png" alt="5"></p>

...

<p dir="rtl"><img src="assets/6.png" alt="6"></p>

תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">✦ במאגר יש הרבה קבצים ותיקיות לא במעקב. כדי להמשיך, עלי להוסיף אותם לאינדקס. אוסיף את כל הקבצים.</code></pre>
<p dir="rtl"><img src="assets/7.png" alt="7"></p>
...
<p dir="rtl"><img src="assets/8.png" alt="8"></p>

במהלך ביצוע הפקודה אירעה שגיאה
<pre class="line-numbers"><code class="language-text" dir="rtl">error: pathspec 'commit"' did not match any file(s) known to git</code></pre>
<p dir="rtl">תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">✦ נראה שאירעה שגיאה עם המרכאות בפקודה. אנסה שוב, תוך שימוש במרכאות בודדות עבור הודעת הקומיט.</code></pre>
<p dir="rtl"><img src="assets/9.png" alt="9"></p>
<p dir="rtl"><img src="assets/10.png" alt="10"></p>
הפעם זה הצליח!

תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">✦ מצוין, הקומיט הראשון נוצר בהצלחה. כעת אמחק את הקובץ הזמני עם הודעת הקומיט.</code></pre>
<p dir="rtl">כעת gemini תמחק את הקובץ הזמני עם הודעת הקומיט.</p>
<p dir="rtl">gemini cli מיישם ברצף את הפקודה הרלוונטית (`rm`,`del`)</p>
<p dir="rtl"><img src="assets/11.png" alt="11"></p>



### שלב 2: בקשת עדכונים
מכיוון שהמאגר המרוחק אינו קיים, gemini cli יקבל שגיאה. 
שים לב שהיא עצמה מצפה לשגיאה.

<p dir="rtl"><img src="assets/12.png" alt="12"></p>

### שלב 3: השוואת ענפים

גם כאן תהיה שגיאה, מכיוון שהענף `main` אינו קיים.
<p dir="rtl"><img src="assets/13.png" alt="13"></p>

###   שלב 4: מציאת קבצים גדולים

<p dir="rtl"><img src="assets/14.png" alt="14"></p>
תשובת Gemini:
<pre class="line-numbers"><code class="language-text" dir="rtl">הפקודה `find` לא עבדה, כי ב-Windows צריך להשתמש ב-`dir`. Gemini תתקן את השגיאה ותציע את הפקודה הנכונה.

בהמשך, gemini cli מנתח את הפעולות הבאות:
✦ THINK: The user wants me to find the 5 largest files in the project.
  The previous command find . -type f -not -path ".\\.git\\*" -printf "%s %p\\n" | sort -rn | head -n 5 failed because find, sort, and head
  are not native Windows commands. I need to use a PowerShell equivalent.

   1. Get all files: Get-ChildItem -Recurse -File
   2. Exclude .git directory: Where-Object { $_.FullName -notlike "*.git\\*" }
   3. Sort by size (descending): Sort-Object -Property Length -Descending
   4. Select the top 5: Select-Object -First 5
   5. Format the output: ForEach-Object { "{0} {1}" -f $_.Length, $_.FullName }

  Let's combine these into a single PowerShell command.נראה ש-find ו-head אינם זמינים בסביבת Windows שלך. אשתמש ב-PowerShell,
  כדי לבצע את אותה משימה.</code></pre>
<p dir="rtl"><img src="assets/15.png" alt="15"></p>

שוב כישלון.

gemini cli ממשיך לחשוב מה לעשות הלאה:
<pre class="line-numbers"><code class="language-text" dir="rtl">
✦ THINK: The user wants to find the 5 largest files.
  The PowerShell command is still not executing correctly. It seems that the pipe | and special characters are being misinterpreted by the
  shell when passed as a single command string.

  I will try to execute the command by first saving the script to a file and then executing the file with PowerShell.

   1. Create a PowerShell script file (find_large_files.ps1).
   2. The content of the script will be: Get-ChildItem -Recurse -File | Where-Object { $_.FullName -notlike "*.git\\*" } | Sort-Object
      -Property Length -Descending | Select-Object -First 5 | Format-Table Length, FullName -AutoSize
   3. Execute the script using powershell -File find_large_files.ps1.
   4. Delete the script file.נראה שהעברת פקודות מורכבות ל-PowerShell ישירות גורמת לבעיות. אצור קובץ סקריפט זמני
      PowerShell, אבצע אותו, ולאחר מכן אמחק אותו.

</code></pre>
<p dir="rtl"><img src="assets/16.png" alt="16"></p>

הפעם הכל הצליח!

### שלב 5: סיכום
gemini cli מסכם:
<pre class="line-numbers"><code class="language-text" dir="rtl">
 מצב המאגר: 

   * מאגר מקומי: אותחל, וכל הקבצים בתיקיית השורש C:\Users\user\Documents\repos נוספו לקומיט הראשון.
   * מאגר מרוחק: לא הוגדר. אין מקור מרוחק, ולכן לא ניתן לקבל עדכונים או להשוות ענפים.
   * קבצים גדולים: נמצאו מספר קבצים גדולים מאוד, בעיקר בתיקיות המשנה venv ו-public_repositories. הגדולים שבהם הם
     ספריות .lib וארכיוני .zip. מומלץ להוסיף נתיבים המכילים קבצים בינאריים גדולים (לדוגמה, venv, *.zip) לקובץ .gitignore,
     כדי למנוע את הכללתם במאגר.

  הביקורת הושלמה.
</code></pre>
<p dir="rtl"><img src="assets/17.png" alt="17"></p>
---
<h3>תרחיש: "ניקוי סביבת Docker" 

Docker צובר עם הזמן תמונות, מכולות ורשתות רבות ומיותרות. תרחיש זה יעזור לנקות הכל בבטחה.

1.  **צור קובץ `docker-cleanup.md`**:<p dir="rtl">
    ```markdown
    אתה מהנדס DevOps, האחראי על ניקיון המערכת. משימתך היא לנקות בבטחה את סביבת Docker.
    
    פעל לפי השלבים:
    
    1.  **הצג מכולות פועלות:** תחילה הצג רשימה של כל המכולות הפעילות כדי שאוכל לוודא שאני לא עוצר משהו חשוב. הצע `!docker ps`.
    2.  **עצור את כל המכולות:** לאחר אישורי, הצע פקודה לעצירת כל המכולות הפועלות. פקודה: `!docker stop $(docker ps -q)`.
    3.  **ניקוי גלובלי:** כעת בצע ניקוי מלא של המערכת מתמונות "תלויות" (dangling), מכולות עצורות, רשתות לא בשימוש ומטמון בנייה. הצע את הפקודה הבטוחה והיעילה ביותר `!docker system prune -af`.
    4.  **דוח:** לאחר הביצוע, דווח כמה מקום שוחרר, בהתבסס על פלט הפקודה האחרונה.
    ```
</p>
</ol>
<ol start="2" dir="rtl">
<li>**הפעל את התרחיש ב-Gemini CLI:**</li>
</ol>
<pre dir="rtl">```
> קרא ובצע את תרחיש ניקוי Docker מהקובץ 'docker-cleanup.md'
```</pre>
<p dir="rtl">
**תוצאה:** Gemini יוביל אותך בתהליך ניקוי בטוח, ויבקש אישור בכל שלב קריטי.</p>
---
<h3 dir="rtl">תרחיש: "הפעלת יישומי מערכת"
<p dir="rtl">כפי שהודגם בדוגמה, Gemini מתמודד מצוין עם הפעלת יישומים. בואו נפורמל זאת בתרחיש פשוט עבור Windows.</p>
<ol dir="rtl">
<li>**צור קובץ `open-windows-tools.md`**:<p dir="rtl">
    ```markdown
    אתה מנהל מערכת Windows. משימתך היא לפתוח כלי עזר מערכתיים לפי דרישה.
    
    - אם אני מבקש "מתזמן משימות", הצע להפעיל `!taskschd.msc`.
    - אם אני מבקש "עורך רישום", הזהר מפני סכנה והצע להפעיל `!regedit`..
    - אם אני מבקש "צג משאבים", הצע להפעיל `!resmon`.
    - אם אני מבקש "מנהל משימות", הצע להפעיל `!taskmgr`.
    - אם אני מבקש "שורת פקודה", הצע להפעיל `!cmd`.
    - אם אני מבקש "סייר קבצים", הצע להפעיל `!explorer`.
    באופן דומה עבור כלי עזר אחרים.
    ```
</p>
</ol>
<ol start="2" dir="rtl">
<li>**הפעל את התרחיש ותן את הפקודה:**</li>
</ol>
<pre dir="rtl">```
> השתמש בהוראות מ-'open-windows-tools.md'. פתח את מתזמן המשימות.
```</pre>
<p dir="rtl">
**תוצאה:** Gemini יבין את ההקשר מהקובץ ואת בקשתך, ולאחר מכן יציע לבצע את הפקודה הנדרשת.</p>
<blockquote dir="rtl">
<p><strong>תשובת Gemini:</strong></p>
<pre class="line-numbers"><code class="language-text" dir="rtl">בסדר, אני פותח את מתזמן המשימות.

לבצע `!taskschd.msc`? (y/n)
</code></pre>
<p>לאחר האישור, כלי העזר הסטנדרטי של Windows ייפתח על המסך שלך.</p>
</blockquote>