## Gemini CLI: Introduzione e primi passi.

**Gemini CLI** √® uno strumento che funziona direttamente nel tuo terminale, comprende la tua codebase e aiuta a correggere gli errori tramite query in linguaggio naturale. √à la risposta di Google a Claude Code di Anthropic.
Puoi utilizzare Gemini 2.5 Pro (lo strumento passer√† a Gemini 2.5 Flash se il limite viene raggiunto) e la sua finestra di contesto da 1 milione di token per eseguire fino a 60 richieste al minuto e 1000 richieste al giorno, il tutto gratuitamente.

### Contenuto
*   Comprendere e navigare in grandi codebase
*   Rilevamento e correzione degli errori
*   Scrittura e test del codice
*   Strumenti Gemini CLI
*   Integrazione di Google CLI con MCP

### Funzionalit√† chiave di Gemini CLI:
*   **Modifica e Refactoring:** Migliora e semplifica automaticamente il tuo codice sotto la guida dell'IA.
*   **Rilevamento e correzione degli errori:** Trova bug e suggerisce correzioni.
*   **Comprensione del codice:** Gemini CLI pu√≤ riassumere l'architettura, spiegare i ruoli dei moduli o costruire mappe del flusso di esecuzione.
*   **Generazione di test:** Crea automaticamente attivit√† di test per `pytest`.
*   **Supporto alla documentazione:** Puoi creare documenti Markdown strutturati, elenchi di modifiche (changelog) e risposte a problemi di GitHub direttamente nel terminale.
*   **Esecuzione di comandi:** Gemini CLI pu√≤ eseguire comandi shell come `git`, `npm`, `pip` e altri, consentendoti di gestire i progetti senza uscire dalla CLI.

---


### Passaggio 1: Prerequisiti

Per iniziare, installa Node.js (versione 18 o superiore). Puoi scaricare l'installer di tua scelta o eseguire i seguenti comandi bash nel tuo terminale:

```bash
# Download e installazione di nvm (Node Version Manager):
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

# Inizializzazione di nvm nella sessione terminale corrente
. "$HOME/.nvm/nvm.sh"

# Download e installazione di Node.js (ad esempio, versione 22):
nvm install 22

# Verifica della versione di Node.js:
node -v # Dovrebbe mostrare "v22.17.0" o simile

# Verifica della versione di npm:
npm -v # Dovrebbe mostrare "10.9.2" o simile
```

> ‚ö†Ô∏è **Importante per gli utenti Windows:**
> Il comando `nvm` sopra indicato √® per **Linux/macOS** e **non funzioner√† in PowerShell o cmd.exe**.
> Per Windows, usa [nvm-windows](https://github.com/coreybutler/nvm-windows), scaricando `nvm-setup.exe` dalla sezione [Releases](https://github.com/coreybutler/nvm-windows/releases).
> In alternativa, puoi installare WSL (Windows Subsystem for Linux) ed eseguire i comandi in Ubuntu o un'altra distribuzione Linux.

---
### Passaggio 2: Configurazione di Gemini CLI

#### Passaggio 2.1: Installazione di Gemini CLI
Dopo che Node.js e npm sono stati installati e verificati, installa Gemini CLI eseguendo il seguente comando nel tuo terminale:
```bash
npx https://github.com/google-gemini/gemini-cli
```
Oppure usa `npm` per l'installazione globale:
```bash
npm install -g @google/gemini-cli
gemini
```
Dopo l'installazione, digita `gemini` nel terminale per accedere allo strumento.



#### Passaggio 2.2: Autenticazione
Puoi utilizzare il tuo account Google personale per l'autenticazione. Questo ti fornir√† fino a 60 richieste al minuto e 1000 richieste al giorno quando utilizzi Gemini.
![First Run](assets/gemini_cli_1/auth.png)

In questa guida, ho utilizzato **Accedi con Google**, ma puoi anche utilizzare una **chiave API** (impostata come variabile d'ambiente o in un file .env) o l'autenticazione **Vertex AI**.

Per generare una nuova chiave API, accedi a **AI Studio** con il tuo account Google e fai clic su "Crea chiave API".
```bash
# Imposta la chiave come variabile d'ambiente
export GEMINI_API_KEY="Your_API_Key"

# Oppure crea un file .env
GEMINI_API_KEY="Your_API_Key"
```
Puoi utilizzare il comando `/auth` nel campo di testo per cambiare i metodi di autenticazione secondo necessit√†.

---

### Passaggio 3: Configurazione del progetto in Gemini CLI
![Start](assets/gemini_cli_1/start.png)
Una volta che la CLI √® in esecuzione, possiamo iniziare a interagire con Gemini dal terminale. Ci sono due modi per lavorare con un progetto.

#### 1. Avviare un nuovo progetto
Per avviare un progetto da zero, esegui i seguenti comandi:
```bash
cd new-project/
gemini
```
All'interno della CLI, usa un prompt per risolvere il problema che ti interessa, ad esempio:
> Scrivi il codice di un encoder per un trasformatore da zero.
![Example 1](assets/gemini_cli_1/example_1.png)
Concedi il permesso di scrivere file:
![File](assets/gemini_cli/file.png)

#### 2. Lavorare con un progetto esistente
Se hai gi√† una codebase, puoi lavorarci eseguendo i seguenti comandi:
```bash
git clone https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo
cd Google-Agent-Development-Kit-Demo
gemini
```
All'interno della CLI, usa un prompt, ad esempio:
> Forniscimi un riepilogo di tutte le modifiche apportate alla codebase nell'ultimo mese.

---

### Passaggio 4: Esperimenti con Gemini CLI
Come esempio, user√≤ il progetto **[ADK-basato üåçüõ´ Pianificatore di viaggi](https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo)**.
Con Gemini CLI mostrer√≤ come:
1.  esplorare la codebase
2.  rilevare un bug o un problema su GitHub o in un file
3.  refactoring del codice e generazione di unit test
4.  creare un report Markdown delle modifiche apportate
5.  visualizzare la codebase generando un diagramma di flusso

#### Esplorazione e comprensione della codebase
Iniziamo chiedendo a Gemini di esplorare e spiegare la codebase.

**Prompt:** `Esplora la directory corrente e descrivi l'architettura del progetto.`

Gemini CLI restituir√† un riepilogo strutturato che spiega l'architettura:
*   **Interfaccia utente:** L'applicazione Streamlit (`travel_ui.py`) fornisce un'interfaccia per l'interazione.
*   **Orchestrazione:** `host_agent` agisce come coordinatore centrale.
*   **Agenti specializzati:** `flight_agent`, `stay_agent`, `activities_agent` per la ricerca di voli, hotel e attivit√†.
*   **Comunicazione:** Gli agenti comunicano tra loro tramite un'API RESTful FastAPI.
*   **Componenti condivisi:** `shared/schemas.py` definisce strutture dati comuni.

Questo ti aiuter√† a orientarti senza dover leggere ogni file manualmente.

#### Analisi e correzione di un problema GitHub
Esaminiamo alcuni problemi aperti dal repository GitHub.

**Prompt:** `Ecco un problema GitHub: [@search https://github.com/AashiDutt/Google-Agent-Development-Kit-Demo/issues/1]. Analizza la codebase e proponi un piano di correzione in 3 passaggi. Quali file/funzioni dovrebbero essere modificati?`

Gemini CLI ha esaminato il problema:
*   Utilizzando la funzione `@search`, ha recuperato i dati da GitHub.
*   Ha identificato la causa principale come un errore di serializzazione JSON (in questo caso, la funzione asincrona `create_session()` non √® stata chiamata con `await`).
*   Ha suggerito modifiche e gestione delle risposte in pi√π file.

Successivamente, la CLI attende l'input dell'utente per valutare le modifiche. Se l'utente √® d'accordo, applicher√† le modifiche suggerite.

#### Implementazione e test della correzione
Ora implementiamo e testiamo le correzioni suggerite da Gemini.

**Prompt:** `Scrivi un unit test per questa modifica in pytest nel file test_shared.py.`

Gemini CLI:
*   Ha inserito `json.dumps()` prima di inviare il payload del task.
*   Ha creato `test_agents.py` per aggiungere unit test.
*   Ha aggiunto un nuovo caso di test per verificare lo schema e il passaggio di messaggi di agenti nidificati.

#### Generazione della documentazione
Ora che le correzioni sono state apportate, riassumiamo le modifiche e le registriamo in Markdown in un file `.txt`.

**Prompt:** `Scrivi un riepilogo Markdown del bug, della correzione e della copertura dei test. Formattalo come voce del changelog sotto la versione "v0.2.0".`

Quindi, per salvare il riepilogo in un documento, ho usato il seguente prompt:

**Prompt:** `Salva questo riepilogo in un file .txt e chiamalo summary.txt`

Gemini CLI utilizza lo strumento `WriteFile` per salvare il file `summary.txt` nella directory del progetto.

#### Generazione di un diagramma di flusso con MCP
Questa sezione estende esperimenti precedenti in cui esploro come Gemini CLI utilizza il **Model Context Protocol (MCP)** per mantenere riepiloghi a livello di file e la cronologia delle attivit√† tra i prompt. Questo conferisce a Gemini una "memoria di lavoro" all'interno di una sessione.

**Prompt:** `Genera un diagramma di flusso che mostri come gli agenti comunicano tramite A2A (agente-ad-agente) e come main.py gestisce il sistema. Evidenzia dove si √® verificato il problema e come √® stato risolto.`

Questa visualizzazione √® stata resa possibile dalla memoria persistente di Gemini, che ha mantenuto il contesto completo della nostra precedente correzione di bug e della struttura dell'agente senza dover ricaricare i file.

### Strumenti Gemini CLI disponibili
La chiamata del comando `/tools` in Gemini CLI mostrer√† un elenco di strumenti disponibili che possono essere utilizzati per eseguire varie attivit√†, come la modifica del codice, la generazione di test, la creazione di documentazione e altro (<a href="https://github.com/google-gemini/gemini-cli">https://github.com/google-gemini/gemini-cli</a>).
![Tools](assets/gemini_cli_1/tools.png)

**ReadFolder (ls)**
Elenca file e cartelle in una directory ‚Äì analogo al comando `ls` nella riga di comando.

**ReadFile (read-file)**
Legge il contenuto completo di un singolo file, utile per creare riepiloghi o analisi.

**ReadManyFiles (read-many-files)**
Legge pi√π file contemporaneamente, di solito per pattern (ad esempio, tutti i file `.js`).

**FindFiles (glob)**
Cerca file per pattern (ad esempio, trova tutti i file `config.json` nel tuo progetto).

**SearchText (grep)**
Cerca testo all'interno dei file, ad esempio per trovare tutti i commenti `TODO`.

**Edit (edit)**
Applica modifiche al codice usando `diff`. Gemini mostra un'anteprima delle modifiche e chiede conferma prima di applicarle.

**WriteFile (write-file)**
Crea nuovi file (ad esempio, `README.md`) con il contenuto fornito dall'utente.

**Shell (shell)**
Esegue comandi direttamente nel terminale se li si precede con `!` (ad esempio, `!npm test`).

**WebFetch (web-fetch)**
Scarica contenuti dal web (HTML o JSON), consentendo a Gemini di analizzare dati esterni.

**GoogleSearch (web-search)**
Esegue una ricerca Google per basare le risposte su informazioni reali (ad esempio, per trovare una spiegazione per un errore).

**Save Memory (memoryTool)**
Salva fatti o preferenze durante una sessione (ad esempio, "Preferisco async/await") per migliorare la coerenza e la coerenza delle risposte.

### Funzioni avanzate

Puoi aggiungere istruzioni speciali per l'IA per un progetto specifico,
creando un file `GEMINI.md` nella directory radice del tuo progetto.
All'interno di questo file, puoi definire regole di progetto,
stili di codice e strumenti che l'agente dovrebbe utilizzare. Ci√≤ garantisce che il codice generato sia conforme agli standard del tuo progetto.

[Esempio di istruzione di sistema](https://github.com/hypo69/hypotez/blob/master/src/endpoints/hypo69/code_assistant/instructions/CODE_RULES.EN.MD)

### Integrazione di Google CLI con MCP

Per la maggior parte delle attivit√† quotidiane, gli strumenti integrati saranno sufficienti. Ma cosa succede se vuoi che Gemini CLI faccia qualcosa di altamente specializzato, come interagire con API specifiche o utilizzare un modello specializzato (ad esempio, un generatore di immagini o uno strumento di analisi della sicurezza)? √à qui che entra in gioco MCP (Model Context Protocol).

In sostanza, MCP √® uno standard aperto che consente agli sviluppatori di aggiungere nuovi strumenti e capacit√† all'IA eseguendo un server con cui la CLI pu√≤ interagire. In Gemini CLI, puoi configurare "MCP server" in un file di impostazioni JSON, e la CLI li tratter√† come strumenti aggiuntivi che pu√≤ utilizzare.

#### Come configurare un server MCP in Google CLI

Come esempio, ti mostrer√≤ come configurare un server MCP per GitHub in Gemini CLI.

All'interno della cartella del tuo progetto, crea una cartella con il comando:

```bash
mkdir -p .gemini && touch .gemini/settings.json
```
Riempi il file con questo codice:
```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": { "GITHUB_PERSONAL_ACCESS_TOKEN": "[YOUR-TOKEN]" }
    }
  }
}
```
[istruzioni su come ottenere un token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic)
Dopodich√©, digita `/quit` in Gemini CLI per uscire, quindi riaprilo.
Vedrai che il server MCP di GitHub √® in esecuzione e pronto all'uso.
![MCP](assets/gemini_cli_1/mcp.png)
Digita il comando `/mcp`, e vedrai un elenco di strumenti GitHub.
![Mcp Commands](assets/gemini_cli_1/mcp_commands.png)
