Скрипт PowerShell, созданный с помощью Gemini CLI, может эффективно получить информацию обо всех пользователях в системе, включая скрытые и встроенные учётные записи, а также их права.

В Windows есть несколько типов пользователей:

  * **Локальные пользователи:** Созданы на компьютере и не зависят от домена.
  * **Доменные пользователи:** Если компьютер подключен к домену.
  * **Встроенные учётные записи:** Системные, такие как `Administrator`, `Guest`, `SYSTEM`, `Local Service`. Многие из них могут быть скрыты.

Вот пример скрипта, который получает исчерпывающую информацию.

-----

### Скрипт аудита пользователей и их прав

Этот скрипт идеально подходит для администраторов, которым нужно быстро получить полный список всех учётных записей в системе и проверить их права.

**Сценарий:** Вам нужно провести аудит системы, чтобы убедиться, что нет несанкционированных учётных записей, и проверить права всех пользователей.

**Команда, которую можно использовать в Gemini CLI:**

```powershell
gemini-cli "Напиши скрипт PowerShell, который получает список всех локальных пользователей, включая скрытые и встроенные. Для каждого пользователя нужно указать, является ли он администратором, и вывести группы, в которые он входит."
```

**Пример сгенерированного скрипта:**

```powershell
Write-Host "--- Аудит пользователей и их прав ---" -ForegroundColor Green

# Получаем всех пользователей, включая скрытые
# `-Filter *` позволяет получить все учётные записи
$users = Get-LocalUser -Filter *

if ($users.Count -eq 0) {
    Write-Host "Пользователи в системе не найдены." -ForegroundColor Red
} else {
    foreach ($user in $users) {
        Write-Host "`nИмя пользователя: $($user.Name)" -ForegroundColor Yellow
        Write-Host "  Полное имя: $($user.FullName)" -ForegroundColor Cyan
        Write-Host "  Описание: $($user.Description)" -ForegroundColor Cyan
        Write-Host "  Включен: $($user.Enabled)" -ForegroundColor Cyan
        Write-Host "  Скрыт: $($user.Hidden)" -ForegroundColor Cyan

        # Проверяем, является ли пользователь администратором
        $isAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole("Administrators")
        $userGroups = Get-LocalGroup -Member $user

        $isAdmin = $userGroups | Where-Object { $_.Name -eq "Администраторы" -or $_.Name -eq "Administrators" }
        if ($isAdmin) {
            Write-Host "  Является администратором: Да" -ForegroundColor Red
        } else {
            Write-Host "  Является администратором: Нет" -ForegroundColor Green
        }
        
        # Выводим все группы, в которые входит пользователь
        Write-Host "  Членство в группах:" -ForegroundColor Cyan
        foreach ($group in $userGroups) {
            Write-Host "    - $($group.Name)" -ForegroundColor Green
        }
    }
}

Write-Host "`n--- Аудит завершён ---" -ForegroundColor Green
```

### Как это работает?

  * **`Get-LocalUser -Filter *`**: Этот командлет получает список всех локальных учётных записей. Флаг `-Filter *` необходим, чтобы получить даже скрытые и системные учётные записи, которые обычно не отображаются.
  * **`Get-LocalGroup -Member $user`**: Этот командлет получает все локальные группы, в которые входит конкретный пользователь. Это самый надёжный способ определить членство в группах, включая "Администраторы".
  * **`$user.Hidden`**: Свойство `Hidden` показывает, является ли учётная запись скрытой (например, некоторые системные учётные записи).
  * **Форматированный вывод**: С помощью `Write-Host` мы выводим информацию, используя разные цвета для лучшей читаемости, что помогает быстро находить ключевые данные.

Этот скрипт предоставляет полную и структурированную информацию, которая является основой для любого аудита безопасности и управления пользователями.