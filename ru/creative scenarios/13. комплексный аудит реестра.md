
### Расширенный скрипт комплексного аудита реестра

Этот скрипт более универсальный и позволяет провести более детальный аудит. Он всё ещё требует прав администратора для доступа к некоторым ключам.

**Пример сгенерированного скрипта:**

```powershell
Write-Host "--- Расширенный аудит реестра Windows ---" -ForegroundColor Green
Write-Host "Скрипт выполняет комплексную проверку системы, безопасности и сети." -ForegroundColor Cyan

# 1. Проверка программ в автозагрузке
Write-Host "`n[1] Проверка программ в автозагрузке" -ForegroundColor Yellow
$autoRunPaths = @(
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run",
    "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run",
    "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run"
)
foreach ($path in $autoRunPaths) {
    if (Test-Path -Path $path) {
        Write-Host "  - Проверка ключа: $path" -ForegroundColor Cyan
        Get-ItemProperty -Path $path -ErrorAction SilentlyContinue | ForEach-Object {
            $name = $_.PSChildName
            $value = $_.$name
            if ($value) {
                Write-Host "    - Название: $name" -ForegroundColor Magenta
                Write-Host "      Путь:   $value" -ForegroundColor Magenta
            }
        }
    }
}

---

# 2. Проверка настроек безопасности
Write-Host "`n[2] Проверка настроек безопасности" -ForegroundColor Yellow

# Проверка UAC
$uacStatus = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").EnableLUA
if ($uacStatus -eq 1) {
    Write-Host "  - UAC (User Account Control): ВКЛЮЧЁН" -ForegroundColor Green
} else {
    Write-Host "  - UAC (User Account Control): ОТКЛЮЧЁН" -ForegroundColor Red
}

# Проверка статуса Защитника Windows (реальный статус, не только реестр)
Write-Host "  - Защитник Windows:" -ForegroundColor Cyan
try {
    $defenderStatus = Get-MpComputerStatus
    $defenderRealtime = $defenderStatus.RealTimeProtectionEnabled
    if ($defenderRealtime) {
        Write-Host "    - Защита в реальном времени: ВКЛЮЧЕНА" -ForegroundColor Green
    } else {
        Write-Host "    - Защита в реальном времени: ОТКЛЮЧЕНА" -ForegroundColor Red
    }
} catch {
    Write-Host "    - Не удалось получить статус Защитника Windows. Возможно, используется сторонний антивирус." -ForegroundColor Yellow
}

---

# 3. Информация о системе и пути к папкам
Write-Host "`n[3] Информация о системе и системных папках" -ForegroundColor Yellow
$osInfo = Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion"
Write-Host "  - Версия ОС: $($osInfo.ProductName) $($osInfo.CurrentVersion)" -ForegroundColor Cyan
Write-Host "  - Сборка ОС: $($osInfo.BuildLabEx)" -ForegroundColor Cyan

$shellFolders = Get-ItemProperty "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"
Write-Host "  - Путь к рабочему столу: $($shellFolders.Desktop)" -ForegroundColor Cyan
Write-Host "  - Путь к документам: $($shellFolders.Personal)" -ForegroundColor Cyan

---

# 4. Аудит сетевых настроек
Write-Host "`n[4] Аудит сетевых настроек" -ForegroundColor Yellow

# Проверка настроек кэша DNS
$dnsCache = Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Services\Dnscache\Parameters" -ErrorAction SilentlyContinue
if ($dnsCache) {
    Write-Host "  - Максимальное время жизни положительного ответа DNS: $($dnsCache.MaxCacheEntryTtlLimit) секунд" -ForegroundColor Cyan
    Write-Host "  - Максимальное время жизни отрицательного ответа DNS: $($dnsCache.MaxNegativeCacheTtl) секунд" -ForegroundColor Cyan
} else {
    Write-Host "  - Не удалось получить настройки кэша DNS." -ForegroundColor Red
}

# Проверка настроек брандмауэра
try {
    $firewallProfiles = Get-NetFirewallProfile
    Write-Host "  - Статус брандмауэра:" -ForegroundColor Cyan
    $firewallProfiles | Format-Table -AutoSize
} catch {
    Write-Host "  - Не удалось получить статус брандмауэра. Запустите скрипт с правами администратора." -ForegroundColor Red
}

# Проверка DHCP для сетевых адаптеров
Write-Host "  - Статус DHCP для сетевых адаптеров:" -ForegroundColor Cyan
Get-NetAdapter | ForEach-Object {
    $adapter = $_
    $ip = Get-NetIPConfiguration -InterfaceIndex $adapter.InterfaceIndex -ErrorAction SilentlyContinue
    if ($ip) {
        Write-Host "    - $($adapter.Name): $($ip.DhcpEnabled)" -ForegroundColor Cyan
    }
}

---

# 5. Аудит истории подключений USB-устройств
Write-Host "`n[5] История подключений USB-устройств" -ForegroundColor Yellow
Write-Host "  (Требует прав администратора)" -ForegroundColor Red
try {
    $usbDevices = Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR\*"
    if ($usbDevices.Count -gt 0) {
        $usbDevices | ForEach-Object {
            Write-Host "  - Устройство: $($_.PSChildName)" -ForegroundColor Magenta
            Write-Host "    Описание: $($_.FriendlyName)" -ForegroundColor Magenta
        }
    } else {
        Write-Host "  - USB-устройства не найдены в реестре." -ForegroundColor Green
    }
} catch {
    Write-Host "  - Ошибка: Не удалось получить доступ к ключу USB-устройств. Запустите скрипт с правами администратора." -ForegroundColor Red
}

Write-Host "`n--- Аудит завершён ---" -ForegroundColor Green
```

Как видите, с помощью PowerShell можно получить очень подробную картину состояния системы, просто заглянув в нужные места реестра и используя соответствующие командлеты. Если у вас есть другие идеи для проверок, дайте знать\!