Проверка и управление обновлениями Windows — важная задача для поддержания безопасности и стабильности системы. 
К сожалению, стандартный PowerShell не имеет встроенных командлетов для этого. Но для этого есть отличный сторонний модуль под названием **`PSWindowsUpdate`**, который стал своего рода стандартом.

С помощью Gemini CLI мы можем сгенерировать скрипт, который использует этот модуль для выполнения всех необходимых операций.

### **Шаг 1: Установка модуля `PSWindowsUpdate`**

Прежде чем запускать скрипт, вам нужно установить этот модуль. Это делается один раз.

Откройте PowerShell от имени администратора и выполните следующую команду:

```powershell
Install-Module -Name PSWindowsUpdate
```

Если вы видите ошибку о том, что "PowerShellGet" устарел, или предупреждение о "trusted repository", просто следуйте инструкциям в консоли. Скорее всего, вам нужно будет подтвердить установку.

### **Шаг 2: Скрипт для проверки и установки обновлений**

После установки модуля, вы можете использовать этот скрипт, чтобы проверить наличие обновлений и, при необходимости, установить их.

**Сценарий:** Вы хотите быстро проверить, есть ли новые обновления Windows, и получить отчёт.

**Команда, которую можно использовать в Gemini CLI:**

```powershell
gemini-cli "Напиши скрипт PowerShell, который использует модуль PSWindowsUpdate. Скрипт должен проверять наличие доступных обновлений Windows, выводить их список, а затем, если обновления найдены, предлагать пользователю установить их."
```

**Пример сгенерированного скрипта:**

```powershell
# Requires -Module PSWindowsUpdate

Write-Host "--- Проверка и установка обновлений Windows ---" -ForegroundColor Green

# 1. Проверка наличия доступных обновлений
Write-Host "`nПроверка доступных обновлений..." -ForegroundColor Yellow
$availableUpdates = Get-WUList

if ($availableUpdates.Count -eq 0) {
    Write-Host "`nОбновления не найдены. Ваша система актуальна." -ForegroundColor Green
} else {
    Write-Host "`nНайдены следующие обновления:" -ForegroundColor Yellow
    $availableUpdates | Format-Table -AutoSize

    # 2. Предложение установить обновления
    $installChoice = Read-Host "`nУстановить найденные обновления? (Y/N)"

    if ($installChoice -eq 'Y' -or $installChoice -eq 'y') {
        Write-Host "`nЗапуск установки обновлений..." -ForegroundColor Yellow
        
        # Загрузка и установка обновлений
        Install-WindowsUpdate -AcceptAll -AutoReboot
        
        Write-Host "`nПроцесс установки завершён. Перезагрузка может потребоваться." -ForegroundColor Green
    } else {
        Write-Host "`nУстановка отменена. Обновления не будут установлены." -ForegroundColor Red
    }
}

Write-Host "`n--- Завершено ---" -ForegroundColor Green
```

### Как это работает?

  * **`Get-WUList`**: Это ключевой командлет из модуля `PSWindowsUpdate`. Он выполняет поиск доступных обновлений так же, как и стандартный Центр обновления Windows.
  * **`Read-Host`**: Эта команда позволяет скрипту взаимодействовать с вами, запрашивая подтверждение перед установкой обновлений.
  * **`Install-WindowsUpdate -AcceptAll -AutoReboot`**: Если вы соглашаетесь, этот командлет запускает процесс установки.
      * `-AcceptAll`: Автоматически соглашается с лицензионными соглашениями.
      * `-AutoReboot`: Автоматически перезагружает компьютер, если это необходимо для завершения установки. Вы можете удалить этот флаг, если хотите перезагрузиться вручную.

Этот скрипт предоставляет вам полный контроль над процессом обновления Windows, что делает его отличным инструментом для системного администрирования.